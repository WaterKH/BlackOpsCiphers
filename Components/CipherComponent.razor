@using BlackOpsCiphers.Components.Modals
@using BlackOpsCiphers.Models

@if (Cipher != null)
{
    <div @onclick=OnClick
         class="bg-gray-800 p-5 rounded-xl shadow-xl shadow-gray-900/50 border border-gray-700 transition-all duration-300 cursor-pointer @GetHoverColor() hover:ring-2 @GetRingColor() hover:scale-[1.02]">
        <div class="flex justify-between items-start mb-3">
            <h3 class="text-xl font-bold text-red-400 font-mono tracking-wide">
                @Cipher.Name
            </h3>
            <span class="px-3 py-1 text-xs font-semibold rounded-full @GetStatusColor()">
                @(Cipher.IsSolved ? "SOLVED" : "NOT SOLVED")
            </span>
        </div>
            
        <div class="space-y-1 text-sm text-gray-400">
            <p class="flex items-center">
                <i class="fas fa-map mr-2 text-red-600" style="font-size: 14px;"></i>
                Location: <span class="ml-1 font-semibold text-amber-300">@Cipher.Location.Name</span>
            </p>
            <p class="flex items-center">
                <i class="fas fa-book-open mr-2 text-yellow-500" style="font-size: 14px;"></i>
                Type: <span class="ml-1 font-semibold text-gray-100">@Cipher.Type.Name</span>
            </p>
        </div>

        <div class="mt-3 pt-3 border-t border-gray-700/50">
            <p class="text-sm italic text-gray-400 truncate">
                @if (Cipher.IsSolved)
                {
                    @("Plaintext: " + Cipher.FormattedPlaintext)
                }
                else
                {
                    @("Ciphertext: " + Cipher.Ciphertext.Replace(" {{ NEW_LINE }} ", Environment.NewLine))
                }
            </p>
        </div>
    </div>
}

@code {
    [CascadingParameter] public IModalService Modal { get; set; } = default!;

    [Parameter]
    public Cipher? Cipher { get; set; }

    [Parameter]
    public Map Map { get; set; } = new();

    [Parameter]
    public Game Game { get; set; } = new();

    public string GetHoverColor()
    {
        if (Cipher == null) return "";

        return Cipher.IsSolved ? "hover:shadow-emerald-800/40" : "hover:shadow-red-800/40";
    }

    public string GetStatusColor()
    {
        if (Cipher == null) return "";

        return Cipher.IsSolved ? "bg-emerald-800 text-emerald-300" : "bg-red-800 text-red-300";
    }

    public string GetRingColor()
    {
        if (Cipher == null) return "";

        return Cipher.IsSolved ? "hover:ring-emerald-500" : "hover:ring-red-500";
    }

    public void OnClick()
    {
        ModalParameters modalParameters = new ModalParameters();
        modalParameters.Add("Cipher", Cipher);
        modalParameters.Add("Map", Map);
        modalParameters.Add("Game", Game);

        Modal.Show<CipherModal>("", modalParameters);
    }
}
